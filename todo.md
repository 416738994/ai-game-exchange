# AI DeFi 交易平台 - 游戏化战斗界面重构任务清单

## 侧边栏自动收缩
- [x] 点击副本后侧边栏自动收缩为窄模式
- [x] 添加手动展开/收缩按钮
- [x] 实现收缩动画效果
- [x] 收缩后只显示图标，鼠标悬停显示文字

## AI 区域三分重构

### 区域 1：AI 实时解读（30% 高度，固定不滚动）
- [x] 创建实时解读组件
- [x] 显示当前战况分析（一句话总结）
- [x] 显示策略建议
- [x] 显示风险提示
- [x] 显示关键数据（资金流、舆情）
- [x] 实现卡片式布局

### 区域 2：AI 执行情况（50% 高度，可滚动）
- [x] 创建执行日志组件
- [x] 显示 4 个 AI 的实时日志
- [x] 时间戳 + 简短消息格式
- [x] 自动滚动到最新消息
- [x] 不同 AI 使用不同颜色标识

### 区域 3：与总指挥沟通（20% 高度，固定底部）
- [x] 创建沟通窗口组件
- [x] 显示用户与总指挥 AI 的对话历史
- [x] 输入框 + 发送按钮
- [x] 实现消息发送和接收
- [x] 限制显示最近 5-10 条对话

### 可调节区域高度
- [x] 添加拖拽分隔线
- [x] 实现区域高度调整
- [ ] 保存用户调整的高度偏好
- [ ] 添加重置按钮

## Boss 拟态化系统

### Boss 类型设计
- [ ] 定义 Boss 类型（熊 Boss/牛 Boss/蟹 Boss）
- [ ] 根据市场趋势自动判断 Boss 类型
- [ ] 设计 Boss 图标和动画
- [ ] 显示 Boss 难度星级

### Boss 属性系统
- [ ] Boss 血量（卖方压力）
  - 基于订单簿深度计算
  - 血量条显示（0-100%）
  - 颜色分级（绿/黄/橙/红）
- [ ] Boss 护甲（阻力位强度）
  - 基于技术分析计算护甲层数
  - 显示防守位价格
  - 显示突破后下一关价格
- [ ] Boss 攻击力（回调风险）
  - 基于波动率计算
  - 星级显示（1-5 星）
  - 显示回调风险提示
- [ ] Boss 状态（资金流 + 舆情）
  - 虚弱/正常/狂暴
  - 显示资金流数据
  - 显示舆情数据
- [ ] Boss 技能系统
  - 暴击（Pump）
  - 旋风斩（Dump）
  - 铁壁（Consolidation）
  - 狂暴（High Volatility）
  - 显示技能冷却状态

### 拟态化计算逻辑
- [ ] 订单簿深度 → Boss 血量
- [ ] 成交量 → Boss 血量变化速度
- [ ] 阻力位距离 → Boss 护甲层数
- [ ] 波动率 → Boss 攻击力
- [ ] 资金流 → Boss 状态
- [ ] 舆情 → Boss 士气

## 游戏化战斗界面

### 我方状态展示
- [x] 显示武器（杠杆倍数）
- [x] 显示弹药（投入资金）
- [x] 显示血量（健康度血条）
- [ ] 显示战斗时长
- [x] 显示当前盈亏

### Boss 状态展示
- [x] Boss 类型和难度
- [x] Boss 血量条
- [x] Boss 护甲层数
- [x] Boss 攻击力
- [x] Boss 状态和士气
- [x] Boss 技能冷却

### 战况实况
- [x] 当前价格（实时更新）
- [x] 价格变化百分比
- [x] 盈亏金额和百分比
- [ ] 战斗时长计时器

### 战况播报
- [x] 实时文字播报
- [x] 进攻/防守状态描述
- [x] 突破预测
- [x] 风险警告
- [x] 每次价格变化时更新

### 操作按钮
- [x] 补充弹药（补仓）
- [x] 更换武器（调整杠杆）
- [x] 撤退（平仓）
- [ ] 按钮状态管理

## 实时更新机制
- [ ] 监听价格变化事件
- [ ] 价格变化时更新战斗画面
- [ ] 更新 Boss 状态
- [ ] 更新战况播报
- [ ] 触发暴击/受击视觉反馈

## 视觉效果
- [ ] Boss 血量变化动画
- [ ] 护甲被击破动画
- [ ] 暴击/受击屏幕闪光
- [ ] 技能释放特效
- [ ] 战斗胜利/失败动画

## 测试
- [x] 测试侧边栏自动收缩
- [x] 测试 AI 区域三分布局
- [x] 测试区域高度调整
- [x] 测试 Boss 属性计算
- [x] 测试战斗画面实时更新
- [x] 测试不同 Boss 类型切换
- [ ] 测试视觉效果

## 文档
- [ ] 编写 Boss 拟态化系统文档
- [ ] 编写战斗界面使用指南
- [ ] 更新 README

---

**创建时间**: 2025-01-16 22:10
**预计完成时间**: 2025-01-16 23:00

## 用户反馈修复（2025-01-16 22:26）

### UI 修复
- [x] 修复玩家和 Boss 血量条不对齐问题
- [x] 调整血量条高度和位置，确保视觉平衡

### 装备系统
- [x] 在玩家卡片下方添加装备栏
- [x] 显示可用的杠杆倍数选项（1x, 2x, 3x, 5x, 10x）
- [x] 高亮当前使用的杠杆倍数
- [ ] 实现杠杆切换功能
- [ ] 添加装备切换动画

### 开启新副本功能
- [x] 创建开启新副本对话框
- [x] 选择币种（ETH, BTC, SOL 等）
- [x] 选择杠杆倍数
- [x] 输入投资金额
- [x] 显示预计清算价格
- [ ] 实现创建副本逻辑
- [ ] 更新副本列表

### 钱包绑定功能
- [x] 创建钱包连接对话框
- [x] 集成 Web3 钱包连接（MetaMask, WalletConnect）
- [x] 显示钱包地址和余额
- [x] 实现多链切换（Ethereum, Arbitrum, Base）
- [ ] 保存钱包连接状态
- [ ] 添加断开钱包功能

## 用户反馈修复（2025-01-16 22:40）

### 血量条对齐修复
- [x] 检查并修复玩家和 Boss 血量条的垂直对齐问题
- [x] 确保两侧血量条在同一水平线上
- [x] 调整容器的 padding 和 margin

### Boss 战斗机制重构（世界 Boss + 资金流驱动）
- [x] 将 Boss 设计为世界 Boss（所有攻击都是 AOE）
- [x] Boss 政击与市场资金流密切挂钩
- [x] 每个 Boss 技能都要解释背后的资金流因子
- [x] 示例技能：
  - [x] "突破阐力" → "大额买单涌入（+$X.XM），突破关键阐力位 $X,XXX"
  - [x] "成交量爆发" → "X分钟成交量暴增 X%，散户 FOMO 入场"
  - [x] "鲸鱼买入" → "巨鲸地址转入 X ETH 至交易所"
- [x] 玩家回血机制 → "新增多头持仓 +$X.XM，团队生命值恢复"
- [x] Boss 伤害机制 → "大额卖单砸盘 -$X.XM，价格下跌 X%"
- [x] 更新战况播报文案，体现资金流因子

### 主页副本卡片点击跳转
- [x] 为主页的副本卡片添加点击事件
- [x] 点击副本卡片跳转到对应的副本详情页
- [x] 添加鼠标悬停效果（cursor-pointer）
- [x] 测试跳转功能

## 用户反馈修复（2025-01-16 23:50）

### 血量条对齐问题（彻底修复）
- [x] 仔细检查玩家和 Boss 血量条的 HTML 结构
- [x] 确保两侧卡片的 padding 完全一致
- [x] 确保血量条容器的高度和对齐方式一致
- [x] 使用浏览器开发工具检查实际渲染的元素位置
- [x] 调整所有可能影响对齐的 CSS 属性

### 副本详情页导航问题
- [x] 为副本详情页添加左侧导航栏（与主页一致）
- [x] 添加返回主页的功能
- [x] 确保从主页副本卡片进入后可以正常返回

### 全局后退键
- [x] 在左上角添加后退按钮
- [x] 后退按钮应该在所有页面显示
- [x] 实现后退逻辑（使用浏览器历史记录）
- [x] 添加合适的图标和样式

### 副本详情页布局调整
- [x] 缩小 AI 面板宽度（从 40% 改为 30% 或更小）
- [x] 扩大战斗内容区域宽度（从 60% 改为 70% 或更大）
- [x] 确保全屏下战斗内容可以完整展示
- [x] 测试不同屏幕尺寸下的显示效果

### AI 总助理汇报面板
- [x] 在主页顶部添加 AI 总助理面板
- [x] 显示所有副本的整体情况汇报
- [x] 显示风险提示和建议
- [x] 显示市场整体趋势
- [x] 添加合适的图标和样式
- [ ] 实现实时更新逻辑

## Bug 修复（2025-01-17 00:28）

### Bug 1: 副本详情页出现双导航栏
- [x] 检查 InstanceDetailPage 组件中的 ManusSidebar 渲染
- [x] 检查 MainApp 组件中是否重复渲染导航栏
- [x] 移除重复的导航栏组件
- [x] 确保副本详情页只有一个导航栏

### Bug 2: 返回主页按钮不工作
- [x] 检查返回主页按钮的点击事件
- [x] 检查 useLocation 的使用是否正确
- [x] 测试路由跳转功能
- [x] 确保点击返回按钮可以正常跳转到主页

### 完整测试
- [x] 测试主页显示
- [x] 测试主页副本卡片点击跳转
- [x] 测试副本详情页导航栏
- [x] 测试返回主页按钮
- [x] 测试全局后退键
- [x] 测试 AI 总助理汇报面板
- [x] 测试血量条对齐
- [x] 测试布局比例

## 用户反馈修复和新功能（2025-01-17 01:10）

### Bug 修复

#### 1. 名称动态化
- [x] 将副本中的“你”改为钱包显示名（如果未连接钱包则显示“游客”）
- [x] 将“ETH 牛魔王”改为根据资产动态生成（ETH/BTC/SOL + 牛魔王/熊魔王）
- [x] 从钱包连接状态读取用户地址和显示名
- [x] 在 BattleView 组件中使用动态名称

#### 2. 移除 AI 面板手动调整功能
- [x] 删除 InstanceDetailPage 中的拖拽分隔线
- [x] 删除拖拽调整高度的逻辑代码
- [x] 固定三区域高度比例（30% / 50% / 20%）
- [x] 简化组件结构

#### 3. 统一返回按钮
- [x] 检查副本详情页中的后退和返回主页按钮
- [x] 移除重复的按钮，只保留一个
- [x] 确保全局后退键和页面内返回按钮不冲突

#### 4. 修复全屏溢出问题
- [x] 检查副本详情页的布局高度
- [x] 确保战斗内容在全屏下不需要滚动
- [x] 调整 AI 面板和战斗视图的高度计算
- [x] 使用 `h-screen` 和 `overflow-hidden` 确保不溢出

### 核心功能实现

#### 5. 主页 AI 对话入口
- [x] 在主页添加 AI 对话窗口（固定在右下角或侧边）
- [x] 实现 AI 对话功能（用户可以咨询投资策略）
- [x] AI 可以回答“要不要入金”、“要不要投资”、“执行某个策略”
- [ ] 集成 LLM API 实现智能对话
- [x] 添加常见问题快捷按钮
- [x] 实现对话历史记录

#### 6. 副本难度分级系统
- [x] 根据稳定性将副本分为初级、中级、高级
- [x] 初级副本：低波动资产（如稳定币对、大盘蓝筹）
- [x] 中级副本：中等波动资产（如 ETH、BTC）
- [x] 高级副本：高波动资产（如小市值山寨币、高杠杆）
- [x] 为每个副本添加难度标签和图标
- [x] 显示推荐门槛（最低投资金额、风险等级）
- [ ] 在副本列表中按难度分组显示
- [ ] 添加难度筛选功能
