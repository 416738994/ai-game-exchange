# 游戏化战斗界面开发进度

## 已完成功能（2025-01-16 22:21）

### 左侧 AI 面板（三区域布局）

#### 区域 1：实时战况分析（30% 高度）
- ✅ 当前形势分析（一句话总结）
- ✅ 策略建议显示
- ✅ 风险提示（颜色分级：绿/橙/红）
- ✅ 实时更新指示器（绿色脉冲点）
- ✅ 图标化展示（趋势/策略/风险）

#### 区域 2：AI 执行日志（50% 高度）
- ✅ 4 个专业 AI 的实时日志
- ✅ 时间戳 + AI 类型 + 消息格式
- ✅ 不同 AI 使用不同颜色标识
  - 盯盘 AI：蓝色
  - 市场 AI：紫色
  - 舆情 AI：绿色
  - 策略 AI：橙色
- ✅ 自动滚动到最新消息
- ✅ 每 5 秒自动添加新日志

#### 区域 3：与总指挥沟通（20% 高度）
- ✅ 用户与总指挥 AI 的对话界面
- ✅ 输入框 + 发送按钮
- ✅ 消息气泡样式（用户蓝色，AI 灰色）
- ✅ 显示最近 5 条对话
- ✅ 支持 Enter 键发送
- ✅ AI 自动回复（1 秒延迟）

#### 可调节高度
- ✅ 拖拽分隔线（hover 时变蓝）
- ✅ 实时调整区域高度
- ⏳ 保存用户偏好（待实现）
- ⏳ 重置按钮（待实现）

### 右侧战斗视图

#### 玩家状态卡片
- ✅ 显示武器（杠杆倍数）
- ✅ 生命值血条（颜色分级：绿/橙/红）
- ✅ 弹药（投入资金）
- ✅ 持仓数量
- ✅ 战果（盈亏金额和百分比）
- ⏳ 战斗时长计时器（待实现）

#### Boss 状态卡片
- ✅ Boss 类型（牛/熊/蟹）
- ✅ Boss 图标（趋势图标）
- ✅ Boss 血量条（渐变色）
- ✅ 护甲层数
- ✅ 攻击力数值
- ✅ 士气状态（高涨/平稳/低落）
- ✅ Boss 技能展示（3 个技能标签）

#### 战况播报
- ✅ 实时文字播报（最近 5 条）
- ✅ 战斗事件描述（进攻/防守/暴击/护甲）
- ✅ Emoji 图标增强可读性
- ✅ 每 8 秒自动更新
- ✅ 自动滚动显示

#### 操作按钮
- ✅ 补充弹药（补仓）
- ✅ 更换武器（调整杠杆）
- ✅ 防御姿态
- ✅ 撤退（平仓，红色危险按钮）
- ⏳ 按钮功能实现（待实现）

### 实时更新机制
- ✅ 模拟价格变化（每 8 秒）
- ✅ 同步更新 Boss 状态
- ✅ 同步更新玩家状态
- ✅ 自动生成战况播报
- ⏳ 真实价格 API 集成（待实现）

## 待实现功能

### Boss 拟态化计算逻辑
- ⏳ 订单簿深度 → Boss 血量
- ⏳ 成交量 → Boss 血量变化速度
- ⏳ 阻力位距离 → Boss 护甲层数
- ⏳ 波动率 → Boss 攻击力
- ⏳ 资金流 → Boss 状态
- ⏳ 舆情 → Boss 士气

### 视觉效果
- ⏳ Boss 血量变化动画
- ⏳ 护甲被击破动画
- ⏳ 暴击/受击屏幕闪光
- ⏳ 技能释放特效
- ⏳ 战斗胜利/失败动画

### 功能完善
- ⏳ 战斗时长计时器
- ⏳ 保存区域高度偏好
- ⏳ 重置高度按钮
- ⏳ 操作按钮功能实现
- ⏳ 真实价格数据集成
- ⏳ 钱包连接
- ⏳ 真实交易执行

## 当前界面效果

### 左侧 AI 面板
- 三个区域清晰分隔
- 实时分析区域固定在顶部，不滚动
- 执行日志区域可滚动，显示 4 个 AI 的活动
- 沟通窗口固定在底部，方便用户与总指挥对话
- 分隔线可拖拽调整高度

### 右侧战斗视图
- 玩家 vs Boss 对战布局
- 玩家卡片（左侧，蓝色边框）
- Boss 卡片（右侧，绿色背景 - 牛 Boss）
- 战况播报卡片（中间下方）
- 操作按钮（底部）

### 整体风格
- 白色/浅色主题
- 游戏化元素（血条、技能、战况播报）
- 清晰的信息层级
- 实时更新动画

## 技术实现

### 组件结构
```
InstanceDetailPage (主页面)
├── 左侧 AI 面板（40% 宽度）
│   ├── AIRealtimeAnalysis (30% 高度)
│   ├── 分隔线 1
│   ├── AIExecutionLog (50% 高度)
│   ├── 分隔线 2
│   └── CommanderChat (20% 高度)
└── 右侧战斗视图（60% 宽度）
    └── BattleView
        ├── 玩家状态卡片
        ├── Boss 状态卡片
        ├── 战况播报
        └── 操作按钮
```

### 状态管理
- 使用 useState 管理区域高度
- 使用 useEffect 模拟实时更新
- 每个组件独立管理自己的数据

### 样式设计
- Tailwind CSS 工具类
- shadcn/ui 组件库
- 响应式布局
- 颜色分级系统（绿/橙/红）

## 下一步计划

1. 实现真实价格数据集成
2. 实现 Boss 拟态化计算逻辑
3. 添加视觉效果和动画
4. 实现操作按钮功能
5. 添加战斗时长计时器
6. 保存用户偏好设置
7. 编写单元测试
8. 性能优化

## 用户反馈点

- 界面是否直观易懂？
- Boss 拟态化是否足够抽象？
- 战况播报是否有趣？
- AI 协作是否清晰可见？
- 操作按钮是否符合游戏习惯？
